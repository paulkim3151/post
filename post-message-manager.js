!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var s in r)("object"==typeof exports?exports:e)[s]=r[s]}}(this,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{PostMessageManagerImpl:()=>i});for(var r,s=256,n=[];s--;)n[s]=(s+256).toString(16).substring(1);var o=function(e,t,r,s){return new(r||(r=Promise))((function(n,o){function i(e){try{d(s.next(e))}catch(e){o(e)}}function a(e){try{d(s.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}d((s=s.apply(e,t||[])).next())}))};class i{constructor(e=3e3){this.requestHandlers={},this.responseHandlers={},this.timeoutMs=e,this._init()}_init(){window.addEventListener("message",this._onMessage.bind(this))}_onMessage(e){return o(this,void 0,void 0,(function*(){var t;const{data:r}=e;if("request"===r.type){const{messageType:s,payload:n,id:o}=r,i=this.requestHandlers[s];if(!i)return;if(i.origin&&e.origin!==i.origin)return;const a={type:"response",parentId:o,messageType:s,payload:yield i.callback(n)};null===(t=e.source)||void 0===t||t.postMessage(a,{targetOrigin:e.origin})}else if("response"===r.type){const{payload:e,parentId:t}=r,s=this.responseHandlers[t];if(!s)return;s.resolve(e),clearTimeout(s.timer),delete this.responseHandlers[t]}}))}register(e){const{messageType:t,callback:r,origin:s}=e;this.requestHandlers[t]&&console.warn(`Handler for ${t} is already registered`),this.requestHandlers[t]={callback:r,origin:s}}unregister(e){delete this.requestHandlers[e]}send(e){return o(this,void 0,void 0,(function*(){const{messageType:t,payload:o,target:i,targetOrigin:a}=e,d=function(e){var t=0;if(!r||s+11>512)for(r="",s=0;t<256;t++)r+=n[256*Math.random()|0];return r.substring(s,11+s++)}();return new Promise(((e,r)=>{const s=setTimeout((()=>{r(new Error("Timeout")),this.unregister(d)}),this.timeoutMs),n={type:"request",id:d,payload:o,messageType:t};i.postMessage(n,a),this.responseHandlers[d]={type:"response",parentId:d,resolve:e,timer:s}}))}))}}return t})()));